<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>AccessControlSystem</title>
</head>

<style type="text/css">
	.parent_box {
		text-align: center;
		width: auto;
		height: auto;
		margin: auto;
	}

	.child_box {
		display: flex;
		justify-content: space-around;
		width: auto;
		height: auto;
		background: #aaa;
		margin: auto;
	}
</style>

<body bgcolor=#aaa>
	<script>
        <!--	该网页为私人使用，请不要尝试攻击, 谢谢~ -->

			function getQueryVariable(variable) {
				var query = window.location.search.substring(1);
				var vars = query.split("&");
				for (var i = 0; i < vars.length; i++) {
					var pair = vars[i].split("=");
					if (pair[0] == variable) { return pair[1]; }
				}
				return (false);
			}

		var _id = getQueryVariable("id");

		function custom_close() {
			window.opener = null;
			window.open('', '_self');
			window.close();
		}

		while ("0009" != _id) {
			password = prompt('请输入密码:', '');
		}

		var g_addr = 'ws://movie.fxtexture.com:9001/';

		function switchPic() {
			var element = document.getElementById('myimage');
			// 生成一个随机数（1到5）并设置图片路径
			var randomNum = Math.floor((Math.random() * 5) + 1);
			var randomPic = "pic_hello" + randomNum + ".png";
			element.src = randomPic;  // 更新图片源

			// 更新显示图片名称的文本
			var picNameText = document.getElementById("picName");
			picNameText.innerHTML = "当前图片: " + randomPic;
		}

		function switchText() {
			var g_text = document.getElementById("p2");
			g_text.innerHTML = "欢迎回家~ !";
		}

		function myrefresh() {
			var element = document.getElementById('myimage');
			if (element.src.match("bulbon")) {
				element.src = "pic_bulboff.png";
			}
			else {
				element.src = "pic_bulbon.png";
				socket = new WebSocket(g_addr);
				socket.addEventListener('open', function (event) { contactServer(); });
				var g_text = document.getElementById("p2");
				g_text.innerHTML = "正在开门...";
				setTimeout(switchPic, 400);  // 延迟400ms后调用switchPic
				setTimeout(switchText, 400); // 延迟400ms后调用switchText
			}
		}

		contactServer = () => {
			socket.send("UnlockDoor");
		}

	</script>

	<!-- 该网页为私人使用，请不要尝试攻击,谢谢~ -->
	<div class="parent_box">
		<p style="font-size:150px">门禁控制</p>
		<p id="p2" style="font-size:60px">“按下解锁”</p>
		<img loading="lazy" id="myimage" onclick="myrefresh()" src="pic_bulboff.png" width="500" height="500">
		<p style="font-size:60px">AccessControlSystem</p>

		<p id="picName" style="font-size:0px">当前图片:</p>
	</div>

</body>
</html>
